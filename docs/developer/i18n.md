# Internationalization Implementation

## Overview
This document details the internationalization (i18n) system implemented in the storefront base template using `next-intl`. The system provides multi-language support with RTL language support, locale detection, and a UI language switching mechanism.

## Current Implementation

### Next-Intl Integration
The storefront implements internationalization using `next-intl`, a comprehensive i18n library for Next.js applications:

1. **Configuration**
   - Centralized i18n configuration in `src/i18n/config.ts`
   - Support for French (default), Arabic (RTL), and English locales
   - Locale-specific settings including text direction (LTR/RTL)

2. **Middleware Processing**
   - Locale detection in `src/middleware.ts`
   - Cookie-based locale persistence
   - Accept-Language header parsing for browser detection
   - Automatic locale cookie management

3. **Translation Management**
   - JSON-based translation files organized by locale
   - Dynamic loading of translations via `next-intl/server`
   - Client-side translation hooks via `useLocale` and `useTranslations`

### Implemented Features

#### 1. Multi-Language Support
The implementation supports three languages:
- English (`en`) - Left-to-right (LTR)
- French (`fr`) - Left-to-right (LTR)
- Arabic (`ar`) - Right-to-left (RTL)

#### 2. Locale Detection & Persistence
Locale detection follows this priority:
1. Existing locale cookie
2. Accept-Language header from browser
3. Default locale (French)

The selected locale is stored in a cookie for consistency across sessions.

#### 3. Right-to-Left (RTL) Language Support
Full RTL support is implemented:
- Automatic HTML `dir` attribute setting based on locale
- Component adaptation for RTL layouts
- Proper text alignment and UI element positioning

#### 4. Language Switcher Component
A complete UI component for language switching:
- Server component that fetches available locales
- Client component with transition handling
- Integration with Next.js navigation for page refresh
- Proper accessibility attributes

## Implementation Details

### File Structure
```
src/
├── i18n/
│   ├── config.ts                 # i18n configuration
│   ├── request.ts               # next-intl server configuration
│   ├── locales/
│   │   ├── en.json              # English translations
│   │   ├── fr.json              # French translations
│   │   └── ar.json              # Arabic translations
│   └── utils/
│       ├── get-dictionary.ts    # Dictionary loading utilities
│       └── locale-detector.ts   # (Future) Locale detection utilities
└── modules/
    └── layout/
        └── components/
            └── locale-switcher/
                ├── index.tsx              # Server component wrapper
                └── locale-switcher-select.tsx  # Client component
```

### Configuration (`src/i18n/config.ts`)
The central configuration file defines:
- Available locales and default locale
- Locale-specific settings (names, text direction)
- Cookie configuration for locale persistence

### Middleware Integration (`src/middleware.ts`)
The middleware handles:
- Locale detection from cookies and headers
- Setting locale cookies for persistence
- Integration with existing region-based routing

### Translation Files Format
Each locale has a JSON file with translations:

```json
{
  "welcome": "Bienvenu",
  "components": {
    "locale-switcher": {
      "label": "Changer de langue"
    }
  }
}
```

### Translation Hooks Usage
Components can access translations using next-intl hooks:

```tsx
import { useLocale, useTranslations } from "next-intl"

export default function MyComponent() {
  const t = useTranslations("components.my-component")
  const locale = useLocale()

  return <p>{t("welcome-message")}</p>
}
```

### Server-Side Translation Loading
Pages can load translations server-side:

```tsx
import { getTranslations } from "next-intl/server"

export default async function HomePage() {
  const t = await getTranslations()
  return <p>{t('welcome')}</p>
}
```

### Language Switcher Implementation
The language switcher consists of two components:
1. Server component that fetches locales
2. Client component that handles selection and navigation

```tsx
// Client component handling selection
"use client"
import { useTransition } from "react"
import { useRouter } from "next/navigation"

export default function LocaleSwitcherSelect({
  children,
  defaultValue
}: Props) {
  const [isPending, startTransition] = useTransition()
  const router = useRouter()

  function onSelectChange(nextLocale: string) {
    startTransition(() => {
      // Set cookie and refresh
      setLocaleCodeCookie(nextLocale)
      router.refresh()
    })
  }
}
```

## Best Practices

### Translation Management
1. Keep translation keys descriptive and consistent
2. Organize translations by feature or module
3. Use nested objects for better organization
4. Provide context for translators through key names

### Performance Considerations
1. Only load required translations per page
2. Leverage Next.js caching mechanisms
3. Minimize client-side JavaScript bundle impact
4. Use server components where possible

### Accessibility
1. Ensure language switchers are keyboard navigable
2. Maintain proper language attributes on HTML elements
3. Provide sufficient contrast for text in all locales
4. Test with screen readers for all supported languages

### RTL Support Guidelines
1. Use CSS logical properties instead of fixed directions
2. Test layouts in both LTR and RTL languages
3. Ensure icons and graphics adapt properly to text direction
4. Verify form element labeling and positioning

## Migration from Previous Approach

### Differences from Planned Implementation
Unlike the originally planned approach documented previously, this implementation:

1. **Uses next-intl instead of custom solution**
   - Leverages battle-tested library instead of building from scratch
   - Benefits from community support and regular updates

2. **Cookie-only locale management**
   - Does not implement URL-based locale prefixes
   - Simplifies routing while maintaining locale persistence

3. **Direct translation file structure**
   - Flatter structure without namespace organization
   - Simpler implementation for smaller applications

### Future Enhancements
Consider implementing these improvements:

1. **Namespaced Translations**
   - Organize translations by feature areas
   - Improve maintainability for larger applications

2. **Advanced Formatting**
   - Date, number, and currency formatting
   - Pluralization and gender-specific translations

3. **SEO Optimizations**
   - Hreflang tags for search engines
   - Canonical URLs for translated content

4. **Content Localization Strategy**
   - Dynamic content loading based on locale
   - CMS integration for translator workflows

## API Reference

### i18nConfig
Central configuration object exported from `src/i18n/config.ts`:

```typescript
const i18nConfig = {
  locales: ["fr", "ar"], // Enabled locales
  defaultLocale: "fr",   // Default locale
  localeConfigs: {       // Locale-specific settings
    en: { name: "English", dir: "ltr" },
    fr: { name: "Français", dir: "ltr" },
    ar: { name: "العربية", dir: "rtl" }
  },
  localeCookieName: "NEXT_LOCALE", // Cookie name
  localeCookieExpiry: 365,         // Cookie expiry in days
  localeInUrl: false               // URL-based locale disabled
}
```

### Utility Functions

#### isValidLocale
Type guard to check if a string is a valid locale:

```typescript
function isValidLocale(locale: string): locale is Locale
```

#### getLocaleDisplayName
Get the display name for a locale:

```typescript
function getLocaleDisplayName(locale: Locale): string
```

#### getLocaleDir
Get the text direction for a locale:

```typescript
function getLocaleDir(locale: string): "ltr" | "rtl"
```

## Troubleshooting

### Common Issues

1. **Translations Not Loading**
   - Verify JSON files exist for all locales
   - Check that keys match between locales
   - Ensure middleware is properly configured

2. **RTL Styling Issues**
   - Confirm `dir` attribute is set on `<html>` element
   - Check CSS for hardcoded left/right values
   - Verify TailwindCSS RTL plugin if used

3. **Locale Cookie Problems**
   - Check cookie name matches configuration
   - Verify cookie domain/path settings
   - Confirm secure/httpOnly flags for production

### Debugging Steps

1. Check browser developer tools for cookie values
2. Verify network requests for translation files
3. Confirm middleware execution in server logs
4. Test locale detection with different browser settings